<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Decorate Your Photo</title>
  <style>
    html, body {
  margin: 0;
  height: 100%;
  font-family: Arial, sans-serif;
}

/* Flex container */
.customisation-wrap {
  height: 100vh;
  display: flex;
}
.wrap-flex {
  display: flex;
  width: 100%;
  height: 100%;
}

/* Left sidebar */
.wrap-left {
  width: 250px;
  background: url("sidebar-01.svg") no-repeat center center;
  background-size: cover;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  box-shadow: 2px 0 8px rgba(0,0,0,0.1);
}

/* Tabs */
.tab-header {
  display: flex;
  gap: 4px;
  margin-bottom: 10px;
}
.tab-btn {
  flex: 1;
  padding: 8px;
  cursor: pointer;
  border: none;
  background: #ddd;
  border-radius: 6px;
  font-weight: bold;
}
.tab-btn.active {
  background: #3286f2;
  color: #fff;
}

/* Tab content container */
.tab-content {
  flex: 1 1 auto;
  overflow-y: hidden;
}

/* Stickers grid */
.choices-wrap-stickers {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
  flex: 1 1 auto;           /* allow to grow and fill sidebar */
  overflow-y: auto;         /* scroll if more stickers */
  height: auto;             /* remove fixed height */
  max-height: 100%;         /* don't overflow sidebar */
}

.single-choice img.sticker {
  width: 100%;
  aspect-ratio: 1/1;
  cursor: pointer;
  border-radius: 8px;
  background: rgba(255,255,255,0.6);
  padding: 4px;
  height: 100px; /* matches the calculation above */
}

/* Right canvas */
.wrap-right {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  background: radial-gradient(#fffaff 10%, #b782f3 65%);
  position: relative;
}

#canvasWrapper {
  position: relative;
  width: 80%;
  aspect-ratio: 3 / 2;
  max-width: 800px;
  background-image: url('FRAME-01.svg');
  background-size: cover; /* or 'contain' if your SVG has padding */
  background-position: center;
  background-repeat: no-repeat;
}

#canvasFrame {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  pointer-events: none;
  z-index: 3;
}


#canvas {
  width: 100%;
  height: 100%;
  background: #eee;
  display: block;
  z-index: 1;
}

#stickerLayer {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 2;
}
#downloadBtn.icon-btn {
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
  color: inherit !important;
  padding: 0 !important;
  margin: 0 !important;
  display: inline-block;
  cursor: pointer;
}

#downloadBtn img {
  width: 64px;
  height: 64px;
  display: block;
}

/* Draggable stickers */
.draggable-sticker {
  position: absolute;
  width: 80px;
  height: 80px;
  cursor: move;
  pointer-events: auto;
  user-select: none;
  transition: box-shadow 0.2s;
  box-shadow: 0 0 8px #3286f2;
}

.resize-handle {
  position: absolute;
  width: 16px;
  height: 16px;
  background: #fff;
  border: 2px solid #3286f2;
  border-radius: 3px;
  z-index: 3;
}
.icon-btn {
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
  color: inherit !important;
  padding: 0 !important;
  margin-top: 10px;
  display: inline-block;
  cursor: pointer;
}
.tab-btn img {
  margin-right: 6px;
}

.download-btn-container {
  position: absolute;
  top: 10px;
  right: 40px;
  z-index: 10;
}
.top-left { top: 0; left: 0; cursor: nwse-resize; }
.top-right { top: 0; right: 0; cursor: nesw-resize; }
.bottom-left { bottom: 0; left: 0; cursor: nesw-resize; }
.bottom-right { bottom: 0; right: 0; cursor: nwse-resize; }

  </style>
</head>
<body>
  <body>
    
  <div class="customisation-wrap">
    <div class="wrap-flex">

      <!-- Left sidebar with tabs -->
      <div class="wrap-left">
        <!-- Tabs -->
        <div class="tab-header">
          <button class="tab-btn active" data-target="stickers" style="background:transparent; border:none; box-shadow:none; padding:0; margin-top:10px;">  <img src="buttons-09.svg" alt="Stickers"> </button>
          <button class="tab-btn" data-target="text" style="background:transparent; border:none; box-shadow:none; padding:0; margin-top:10px;"> <img src="buttons-10.svg" alt="Texts"> </button>
        </div>

        <!-- Tab content -->
        <div class="tab-content" id="stickers">
          <div class="choices-wrap choices-wrap-stickers">
            <div class="single-choice"><img src="emoji-02.svg" class="sticker" onclick="addSticker('emoji-02.svg')"></div>
            <div class="single-choice"><img src="emoji-03.svg" class="sticker" onclick="addSticker('emoji-03.svg')"></div>
            <div class="single-choice"><img src="emoji-04.svg" class="sticker" onclick="addSticker('emoji-04.svg')"></div>
            <div class="single-choice"><img src="emoji-05.svg" class="sticker" onclick="addSticker('emoji-05.svg')"></div>
            <div class="single-choice"><img src="emoji-06.svg" class="sticker" onclick="addSticker('emoji-06.svg')"></div>
            <div class="single-choice"><img src="emoji-07.svg" class="sticker" onclick="addSticker('emoji-07.svg')"></div>
            <div class="single-choice"><img src="emoji-08.svg" class="sticker" onclick="addSticker('emoji-08.svg')"></div>
            <div class="single-choice"><img src="emoji-09.svg" class="sticker" onclick="addSticker('emoji-09.svg')"></div>
            <div class="single-choice"><img src="emoji-10.svg" class="sticker" onclick="addSticker('emoji-10.svg')"></div>
            <div class="single-choice"><img src="emoji-11.svg" class="sticker" onclick="addSticker('emoji-11.svg')"></div>
            <div class="single-choice"><img src="emoji 2-02.svg" class="sticker" onclick="addSticker('emoji 2-02.svg')"></div>
            <div class="single-choice"><img src="emoji 2-03.svg" class="sticker" onclick="addSticker('emoji 2-03.svg')"></div>
            <div class="single-choice"><img src="emoji 2-04.svg" class="sticker" onclick="addSticker('emoji 2-04.svg')"></div>
            <div class="single-choice"><img src="emoji 2-05.svg" class="sticker" onclick="addSticker('emoji 2-05.svg')"></div>   
            <div class="single-choice"><img src="emoji 2-06.svg" class="sticker" onclick="addSticker('emoji 2-06.svg')"></div>
            <div class="single-choice"><img src="emoji 2-07.svg" class="sticker" onclick="addSticker('emoji 2-07.svg')"></div>
          </div>
        </div>

        <div class="tab-content" id="text" style="display: none;">
          <div class="choices-wrap choices-wrap-text">
            <div class="single-choice">Text Option 1</div>
            <div class="single-choice">Text Option 2</div>
            <div class="single-choice">Text Option 3</div>
          </div>
        </div>
      </div>
<div class="wrap-right">
  <!-- Download button container -->
  <div class="download-btn-container">
    <button id="downloadBtn" onclick="downloadImage()" class="icon-btn">
      <img src="buttons-08.svg" alt="Download" style="width:90px; height:64px; display:block;">
    </button>
    <div id="qrCodeContainer" style="margin-top: 20px;"></div>


  </div>
      <!-- Right canvas -->
      <div class="wrap-right">
  <div id="canvasWrapper">
  <canvas id="canvas" width="900" height="600"></canvas>
  <div id="stickerLayer"></div>
  <img id="canvasFrame" src="FRAME-01.svg" alt="Polaroid Frame">
</div>

<img id="canvasFrame" src="FRAME-01.svg" alt="Frame" style="
    position:absolute;
    top:0; left:0; width:100%; height:100%;
    pointer-events:none;
    z-index:3;">
</div>
  <div id="qrCodeContainer" style="margin-top: 20px;"></div>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>


  </div>
</body>
  <script>
const tabButtons = document.querySelectorAll('.tab-btn');
const tabContents = document.querySelectorAll('.tab-content');

tabButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    tabButtons.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    tabContents.forEach(tc => tc.style.display = 'none');
    const target = document.getElementById(btn.dataset.target);
    target.style.display = 'block';
  });
});

// Load user photo from localStorage
window.onload = function() {
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const userPhoto = localStorage.getItem('userPhoto');
  if (userPhoto) {
    const img = new Image();
    img.onload = function() {
      canvas.width = img.width;
      canvas.height = img.height;
      ctx.drawImage(img, 0, 0);
      // Optionally adjust stickerLayer size if needed
      document.getElementById('stickerLayer').style.width = img.width + 'px';
      document.getElementById('stickerLayer').style.height = img.height + 'px';
    };
    img.src = userPhoto;
  }
};

// Add sticker as draggable/resizable element
function addSticker(src) {
  const stickerLayer = document.getElementById('stickerLayer');
  const sticker = document.createElement('div');
  sticker.className = 'draggable-sticker';
  sticker.style.left = '40px';
  sticker.style.top = '40px';
  sticker.style.width = '80px';
  sticker.style.height = '80px';

  const img = document.createElement('img');
  img.src = src;
  img.style.width = '100%';
  img.style.height = '100%';
  img.style.pointerEvents = 'none';
  sticker.appendChild(img);

  // Add 4 resize handles
  const corners = [
    { name: 'tl', style: 'left:0;top:0;cursor:nwse-resize;' },
    { name: 'tr', style: 'right:0;top:0;cursor:nesw-resize;' },
    { name: 'bl', style: 'left:0;bottom:0;cursor:nesw-resize;' },
    { name: 'br', style: 'right:0;bottom:0;cursor:nwse-resize;' }
  ];
  corners.forEach(corner => {
    const handle = document.createElement('div');
    handle.className = 'resize-handle';
    handle.dataset.corner = corner.name;
    handle.style.cssText = corner.style + 'position:absolute;width:16px;height:16px;background:#fff;border:2px solid #3286f2;border-radius:3px;z-index:3;';
    sticker.appendChild(handle);
  });

  stickerLayer.appendChild(sticker);

  // Drag logic (mouse + touch)
  let offsetX, offsetY, isDragging = false;
  let isResizing = false, startX, startY, startW, startH, startLeft, startTop, currentCorner;

  function getEventXY(e) {
    if (e.touches && e.touches.length) {
      return { x: e.touches[0].clientX, y: e.touches[0].clientY };
    }
    return { x: e.clientX, y: e.clientY };
  }

  // Drag start
  function dragStart(e) {
    if (e.target.classList.contains('resize-handle')) return;
    e.preventDefault();
    isDragging = true;
    sticker.style.zIndex = 10;
    const { x, y } = getEventXY(e);
    offsetX = x - sticker.offsetLeft;
    offsetY = y - sticker.offsetTop;
    document.addEventListener('mousemove', dragMove);
    document.addEventListener('mouseup', dragEnd);
    document.addEventListener('touchmove', dragMove, { passive: false });
    document.addEventListener('touchend', dragEnd);
  }
  function dragMove(e) {
    if (!isDragging) return;
    e.preventDefault();
    const { x, y } = getEventXY(e);
    sticker.style.left = (x - offsetX) + 'px';
    sticker.style.top = (y - offsetY) + 'px';
  }
  function dragEnd(e) {
    isDragging = false;
    sticker.style.zIndex = '';
    document.removeEventListener('mousemove', dragMove);
    document.removeEventListener('mouseup', dragEnd);
    document.removeEventListener('touchmove', dragMove);
    document.removeEventListener('touchend', dragEnd);
  }
  sticker.addEventListener('mousedown', dragStart);
  sticker.addEventListener('touchstart', dragStart, { passive: false });

  // Resize logic (mouse + touch)
  function resizeStart(e) {
    e.stopPropagation();
    e.preventDefault();
    isResizing = true;
    currentCorner = e.target.dataset.corner;
    const { x, y } = getEventXY(e);
    startX = x;
    startY = y;
    startW = sticker.offsetWidth;
    startH = sticker.offsetHeight;
    startLeft = sticker.offsetLeft;
    startTop = sticker.offsetTop;
    document.addEventListener('mousemove', resizeMove);
    document.addEventListener('mouseup', resizeEnd);
    document.addEventListener('touchmove', resizeMove, { passive: false });
    document.addEventListener('touchend', resizeEnd);
  }
  function resizeMove(e) {
    if (!isResizing) return;
    e.preventDefault();
    const { x, y } = getEventXY(e);
    let dx = x - startX;
    let dy = y - startY;
    let newW = startW, newH = startH, newLeft = startLeft, newTop = startTop;
    switch (currentCorner) {
      case 'tl':
        newW = Math.max(40, startW - dx);
        newH = Math.max(40, startH - dy);
        newLeft = startLeft + dx;
        newTop = startTop + dy;
        break;
      case 'tr':
        newW = Math.max(40, startW + dx);
        newH = Math.max(40, startH - dy);
        newTop = startTop + dy;
        break;
      case 'bl':
        newW = Math.max(40, startW - dx);
        newH = Math.max(40, startH + dy);
        newLeft = startLeft + dx;
        break;
      case 'br':
        newW = Math.max(40, startW + dx);
        newH = Math.max(40, startH + dy);
        break;
    }
    sticker.style.width = newW + 'px';
    sticker.style.height = newH + 'px';
    sticker.style.left = newLeft + 'px';
    sticker.style.top = newTop + 'px';
  }
  function resizeEnd(e) {
    isResizing = false;
    document.removeEventListener('mousemove', resizeMove);
    document.removeEventListener('mouseup', resizeEnd);
    document.removeEventListener('touchmove', resizeMove);
    document.removeEventListener('touchend', resizeEnd);
  }
  sticker.querySelectorAll('.resize-handle').forEach(handle => {
    handle.addEventListener('mousedown', resizeStart);
    handle.addEventListener('touchstart', resizeStart, { passive: false });
  });
}

// Download image (stickers not included in download, see note)
function downloadImage() {
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const userPhoto = localStorage.getItem('userPhoto');
  if (!userPhoto) return;
  const img = new Image();
  img.onload = function() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

    // Draw all stickers
    const stickers = document.querySelectorAll('.draggable-sticker');
    stickers.forEach(stickerEl => {
      const imgEl = stickerEl.querySelector('img');
      if (!imgEl) return;
      // Calculate position relative to canvas
      const stickerRect = stickerEl.getBoundingClientRect();
      const canvasRect = canvas.getBoundingClientRect();
      const x = stickerRect.left - canvasRect.left;
      const y = stickerRect.top - canvasRect.top;
      const w = stickerEl.offsetWidth;
      const h = stickerEl.offsetHeight;
      ctx.drawImage(imgEl, x, y, w, h);
    });

    // Download the result
    const link = document.createElement('a');
    link.download = 'decorated-photo.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
    
    
// Generate QR code
    const qrContainer = document.getElementById('qrCodeContainer');
    if (qrContainer) {
      qrContainer.innerHTML = ''; // Clear previous QR
      QRCode.toCanvas(qrContainer, dataURL, function (error) {
        if (error) console.error(error);
        else console.log('QR code generated!');
      });
    }
  };
  img.src = userPhoto;
}
window.downloadImage = downloadImage;
</script>